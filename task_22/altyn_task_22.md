# Задача коммивояжера (Travelling salesman problem)

## Постановка задачи
Имеется N городов, связанных дорогами. Расстояния между городами известны. Коммивояжер (бродячий торговец) должен выйти из первого города, посетить по одному разу в 
некотором порядке города 2,3..n и вернуться в первый город. В каком порядке следует посещать города, чтобы замкнутый путь коммивояжера имел кратчайшее расстояние?

### Вариант 9:

Решить задачу коммивояжера с применением генетического алгоритма, с учетом следующих требований:
   - Придумать условия задачи с количеством городов не менее 8.
   - Численность популяции не менее 4 особей, в скрещивании участвует половина популяции. 
   - Для скрещивания выбираются сильнейшие особи, скрещивание – двухточечное.
   - До выполнения алгоритма сформулировать стратегию применения оператора мутации.
   - Для скрещивания и мутации использовать альтернативную кодировку особей.
   - Для альтернативной кодировки отобранных особей и декодировки полученных потомков оформить подробные пошаговые комментарии.
   - Сформировать не менее 3 поколений, не считая первоначального.

## Условия задачи
Матрица расстояний: 

|       | **1** | **2** | **3** | **4** | **5** | **6** | **7** | **8** |
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|-------|-------|-------|
| **1** | **∞** |   4   |   8   |   7   |   3   |   12  | 5     |  9    |
| **2** |   4   | **∞** |   6   |  3    |   7   | 5     |   10  | 11    |
| **3** |   8   |   6   | **∞** |   9   |  12   |  4    | 3     | 6     |
| **4** |  7    |   3   |   9   | **∞** |   6   | 8     | 4     |  5    |
| **5** |   3   |   7   |   12  |   6   | **∞** | 5     | 7     |  8    | 
| **6** |  12   |   5   |   4   |   8   |   5   | **∞** |  6    |  9    |
| **7** |   5   |   10  |   3   |   4   |   7   |  6    | **∞** | 2     |
| **8** |   9   |   11  |  6    |   5   |   8   |  9    | 2     | **∞** |

##### Стратегия применения мутации:
Мутация применяется в 50% случаев и заключается в случайной перестановке двух городов в маршруте.

### Начальная популяция:
Сформируем начальную популяцию из 4 особей, где каждая особь представляет собой случайным образом сгенерированный маршрут:

|        | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|--------|---|---|---|---|---|---|---|---|
| **x1** | 1 | 5 | 3 | 6 | 8 | 7 | 2 | 4 |
| **x2** | 1 | 3 | 8 | 7 | 5 | 6 | 4 | 2 |
| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
| **x4** | 1 | 8 | 6 | 5 | 3 | 2 | 7 | 4 |

### Отбор особей начальной популяции для скрещивания:
Вычислим степень приспособленности (фитнес-функцию) всех особей в популяции. Фитнес-функция - длина маршрута, задаваемого особью.
Суммируем значения из матрицы на пересечении городов.

| Особь  | f(x)  |
|--------|-------|
| **x1** | 49    |
| **x2** | 56   |
| **x3** | 45    |
| **x4** | 62   |

#### Элитарный способ скрещивания: берем две самые сильные особи.

Таким образом, особи x1 (49) и x3 (45) будут участвовать в скрещивании.

### Скрещивание особей начальной популяции:

#### Альтернативное кодирование:

| **x1** | 1 | 5 | 3 | 6 | 8 | 7 | 2 | 4 |
|--------|---|---|---|---|---|---|---|---|
| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |

Перед скрещиванием особей применим альтернативную кодировку. Альтернативный код особи получается из ее натурального кода.

Составим таблицу для кодирования. В первой строке будет располагаться натуральный код особи, во второй - возрастающая перестановка от 1 до 8, а в третьей - номера позиций в этой перестановке, всегда начинающиеся с единицы.

**Альтернативное кодирование особи x1**
| **x1** | 1 | 5 | 3 | 6 | 8 | 7 | 2 | 4 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |

Альтернативный код получается в результате прохода по элементам кода особи, поиска текущего элемента в возрастающей последовательности и его сопоставления с позицией.

 1. Первый элемент кода особи равен 1. В возрастающей последовательности
    он находится на 1 месте и соответствует позиции 1. Запишем 1.

| **x1** | 5 | 3 | 6 | 8 | 7 | 2 | 4 |
|--------|---|---|---|---|---|---|---|
| **N**  | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 |

 2. Следующий элемент - 5. Он находится на 4 месте и соответствует позиции 4. Запишем 4.

| **x1** | 3 | 6 | 8 | 7 | 2 | 4 |
|--------|---|---|---|---|---|---|
| **N**  | 2 | 3 | 4 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 3 | 4 | 5 | 6 |

3. Следующий элемент - 3. Он находится на 2 месте и соответствует позиции 2. Запишем 2.

| **x1** | 6 | 8 | 7 | 2 | 4 |
|--------|---|---|---|---|---|
| **N**  | 2 | 4 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 3 | 4 | 5 |

4. Следующий элемент - 6. Он находится на 3 месте и соответствует позиции 3. Запишем 3.

| **x1** | 8 | 7 | 2 | 4 |
|--------|---|---|---|---|
| **N**  | 2 | 4 | 7 | 8 |
| **№**  | 1 | 2 | 3 | 4 |

5. Следующий элемент - 8. Он находится на 4 месте и соответствует позиции 4. Запишем 4.

| **x1** | 7 | 2 | 4 |
|--------|---|---|---|
| **N**  | 2 | 4 | 7 |
| **№**  | 1 | 2 | 3 |

6. Следующий элемент - 7. Он находится на 3 месте и соответствует позиции 3. Запишем 3.

| **x1** | 2 | 4 |
|--------|---|---|
| **N**  | 2 | 4 |
| **№**  | 1 | 2 |

7. Следующий элемент - 2. Он находится на 1 месте и соответствует позиции 1. Запишем 1.

| **x1** | 4 |
|--------|---|
| **N**  | 4 |
| **№**  | 1 |

8. Последний элемент - 4. Он находится на 1 месте и соответствует позиции 1. Запишем 1.

Получившийся альтернативный код особи **x1: 14234311**

#### Альтернативная кодировка особи x3:

Составим таблицу для особи x3:

| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |

После проведения аналогичных операций получим альтернативный код особи **x3: 11251346**

#### Скрещивание: 
Применим двухточечное скрещивание к особям.

| **x1** | 1 | 4 | 2 | 3 | 4 | 3 | 1 | 1 |
|--------|---|---|---|---|---|---|---|---|
| **x3** | 1 | 1 | 2 | 5 | 1 | 3 | 4 | 6 |
-----------------------------------------------------------------
Разделим х1 и х3 на три части. Для первого потомка: первая и последняя части - х1, а средняя часть - х3. Для второго потомка: первая и последняя части - х3, а средняя часть - х1.

| **x5** | 1 | 4 | 2 | 5 | 1 | 3 | 1 | 1 |
|--------|---|---|---|---|---|---|---|---|
| **x6** | 1 | 1 | 2 | 3 | 4 | 3 | 4 | 6 |

#### Мутация: 
Пусть мутация произошла с особью x6, тогда поменяем 3 и 6 разряды местами:
| **x6** | 1 | 1 | 2 | 3 | 4 | 4 | 3 | 6 |

### Декодирование потомков:

Для декодирования особей x5 и x6 проведем обратное альтернативное кодирование.
Натуральный код особи **x5:**
| **x5** | 1 | 4 | 2 | 5 | 1 | 3 | 1 | 1 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 4 | 2 | 5 | 1 | 3 | 1 | 1 |

Полученный маршрут: **1-8-7-3-2-6-5-4**

Натуральный код особи **x6:**
| **x5** | 1 | 1 | 2 | 3 | 4 | 4 | 3 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 1 | 2 | 3 | 4 | 4 | 3 | 6 |

Полученный маршрут: **1-2-7-4-3-8-5-6**

#### Вычислим фитнес-функцию новых особей (посчитаем длину маршрута):

| Особь  | f(x) |
|--------|------|
| **x5** |  63  |
| **x6** |  45 |

Новое поколение будет состоять из особей, отобранных элитарным методом для скрещивания, и их потомков.

### I поколение

|        | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | f(x) |
|--------|---|---|---|---|---|---|---|---|------|
| **x1** | 1 | 5 | 3 | 6 | 8 | 7 | 2 | 4 | 49   |
| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |
| **x5** | 1 | 8 | 7 | 3 | 2 | 6 | 5 | 4 | 63   |
| **x6** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |

### Отбор родительских особей I поколения:
Вычислим степень приспособленности всех особей в популяции.
|        | f(x) |
|--------|------|
| **x1** | 49   |
| **x3** | 45   |
| **x5** | 63   |
| **x6** | 45   |
Поскольку особи x3 и x6 одинаковы, применим мутацию к одной из них, чтобы избежать дубликатов.

### Мутация особи x6:

Поменяем местами два случайных элемента.

| **x6** | 1 | 2 | 7 | 4 | 3 | 8 | 6 | 5 |

Теперь особи x3 и x6 различаются.

Элитарным методом отберем особи x3 и x6 для скрещивания.

### Скрещивание особей I поколения:

Применим двухточечное скрещивание к особям x3 и x6.

| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
|--------|---|---|---|---|---|---|---|---
| **x6** | 1 | 2 | 7 | 4 | 3 | 8 | 6 | 5 |


#### Разделение особей:

Для первого потомка: первая и последняя части - x3, а средняя часть - x6. Для второго потомка: первая и последняя части - x6, а средняя часть - x3.

Применим одноточечное скрещивание к особям.

| **x7** | 1 | 2 | 7 | 4 | 3 | 8 | 6 | 5 |
|--------|---|---|---|---|---|---|---|---|
| **x8** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |

### Мутация:

Пусть мутация произошла с особью x8, тогда поменяем 6 и 8 разряды местами:

| **x8** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |

### Декодирование потомков:

Для декодирования особей x7 и x8 проведем обратное альтернативное кодирование.

#### Натуральный код особи x7:
| **x7** | 1 | 2 | 7 | 4 | 3 | 8 | 6 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 7 | 4 | 3 | 8 | 6 | 5 |

Полученный маршрут: 1-2-7-4-3-8-6-5

#### Натуральный код особи x8:
| **x8** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
Полученный маршрут: 1-2-7-4-3-8-5-6

### II поколение:

Новая популяция будет состоять из особей, отобранных элитарным методом, и их потомков.
|        | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | f(x) |
|--------|---|---|---|---|---|---|---|---|------|
| **x1** | 1 | 5 | 3 | 6 | 8 | 7 | 2 | 4 | 49   |
| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |
| **x7** | 1 | 2 | 7 | 4 | 3 | 8 | 6 | 5 | 48   |
| **x8** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |

Таким образом, новое поколение будет состоять из особей x1, x3, x7 и x8.

### Скрещивание особей II поколения:

Применим двухточечное скрещивание к особям x3 и x8.
| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **x8** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |

#### Разделение особей:

Для первого потомка: первая и последняя части - x3, а средняя часть - x8. Для второго потомка: первая и последняя части - x8, а средняя часть - x3.
| **x9** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **x10**| 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
### Мутация:

Пусть мутация произошла с особью x10, тогда поменяем 3 и 7 разряды местами:

| **x10**| 1 | 2 | 5 | 4 | 3 | 8 | 7 | 6 |

### Декодирование потомков:

Для декодирования особей x9 и x10 проведем обратное альтернативное кодирование.

#### Натуральный код особи x9:
| **x9** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 |

Полученный маршрут: **1-2-7-4-3-8-5-6**

#### Натуральный код особи x10:
| **x10**| 1 | 2 | 5 | 4 | 3 | 8 | 7 | 6 |
|--------|---|---|---|---|---|---|---|---|
| **N**  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
| **№**  | 1 | 2 | 5 | 4 | 3 | 8 | 7 | 6 |

Полученный маршрут: **1-2-5-4-3-8-7-6**

### Итоговая популяция:

Новая популяция будет состоять из особей, отобранных элитарным методом, и их потомков.

|        | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | f(x) |
|--------|---|---|---|---|---|---|---|---|------|
| **x3** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |
| **x8** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |
| **x9** | 1 | 2 | 7 | 4 | 3 | 8 | 5 | 6 | 45   |
| **x10**| 1 | 2 | 5 | 4 | 3 | 8 | 7 | 6 | 50   |

Таким образом, лидер популяции - особь **x3** с маршрутом **1-2-7-4-3-8-5-6-1** и длиной маршрута **45**.

### ОТВЕТ:

##### Найденный маршрут: 1-2-7-4-3-8-5-6-1

#### Длина маршрута: 45
