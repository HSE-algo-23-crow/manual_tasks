# Задание №22
## Постановка задачи о рюкзаке
Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, n<sub>i</sub> предмет имеет массу w<sub>i</sub> > 0 и стоимость p<sub>i</sub> > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна.

### Вариант 1:

1. Решить задачу о рюкзаке с применением генетического алгоритма, с учетом следующих требований:
   - Придумать условия задачи с количеством предметов не менее 7.
   - Численность популяции не менее 4 особей, в скрещивании участвует половина популяции. 
   - Для скрещивания выбираются сильнейшие особи, скрещивание – одноточечное.
   - До выполнения алгоритма сформулировать стратегию применения оператора мутации.
   - Сформировать не менее 3 поколений, не считая первоначального.
2. Для условий 1 варианта задания 20:
   - Сгенерировать 2 особи (случайных решения) в виде перестановки номеров городов, которая всегда начинается с единицы.
   - Рассчитать фитнес-функцию для особей.
   - Закодировать их с применением альтернативной кодировки с пошаговыми комментариями.
   - Декодировать альтернативную кодировку с пошаговыми комментариями.

# 1. Задача о рюкзаке
## Условия задачи

| Предметы  |  1 | 2  | 3  | 4  |  5 |  6 |  7 |
|:----------|:--:|:--:|:--:|:--:|:--:|:--:|:--:| 
| Вес       |  2 | 7  | 9  | 5  |  5 |  6 |  2 |
| Стоимость |  5 | 15 | 13 |  7 | 11 | 10 |  4 |  
  
Ограничение вместимости: 22
## Стратегия применения мутации
Если особь является нежизнеспособной, то есть вес выбранных предметов больше показателя ограничения веса, следует провести мутацию по следующему принципу: 
1) Избавиться от предмета или предметов, без которых  не будет превышаться ограничение веса рюкзака, при этом минимизируя количество и вес предмета/предметов, от которых избавляемся.
2) Если, следуя пункту 1, мутирующая особь становится идентичной  другой особи популяции, кроме родителей, то следует избавиться от предмета/предметов, которые на следующем без изменения (более худшем) месте по минимизации веса предмета/предметов, от которых избавляемся.

**"Спонтанная мутация"**

Если особь идентична родителю, разрешается провести спонтанную мутацию: 
- в случае, когда можно поместить 1 или более предметов в особь, делаем это;
- в случае, когда нельзя поместить ни одного предмета в особь (места меньше, чем минимальный вес невзятого предмета) - следуем основным пунктам 1 и 2 в стратегии мутации.

## Решение 
### Начальная популяция (№0)
Формируем начальную популяцию (k=4). 

|  Особи |   |   |   |   |   |   |   |
|--------|---|---|---|---|---|---|---|
| **x1** | 1 | 1 | 1 | 0 | 0 | 0 | 1 |
| **x2** | 0 | 0 | 1 | 1 | 1 | 0 | 0 |
| **x3** | 1 | 0 | 0 | 1 | 1 | 1 | 1 |
| **x4** | 1 | 0 | 1 | 0 | 1 | 1 | 0 |

Расчет фитнес-функций (сумма стоимости выбранных предметов)

f(x1) = 5+15+13+4=37 (вес 20)  
f(x2) = 13+7+11=31  (вес 19)  
f(x3) = 5+7+11+10+4=37  (вес 20)  
f(x4) = 5+13+11+10=39  (вес 22)
##
### Скрещивание 
В скрещивании участвует половина популяции. Для скрещивания выбираем сильнейших особей **x1** и **x4**. Метод скрещивания: **одноточечный разрез**, точка разрыва - между 2-й и 3-й позициями. 

|        |       |        |      |       |       |       |       |
|--------|-------|--------|------|-------|-------|-------|-------|
| **x1** | **1** | **1** | **1** | **0** | **0** | **0** | **1** |
| **x4** |     1 |     0 |     1 |     0 |     1 |     1 |     0 |

Получаем 

|        |       |       |       |       |       |       |       |
|--------|-------|-------|-------|-------|-------|-------|-------|
| **x5** | **1** | **1** | 1     | 0     | 1     |     1 |     0 |
| **x6** | 1     | 0     | **1** | **0** | **0** | **0** | **1** |

Особь **x5**  является нежизнеспособной, так как сумма весов выбранных предметов  = 2+7+9+5+6=29, что существенно превышает ограничение веса в 22. Следуя принципам стратегии мутаций, убираем предмет №2, вес становится = 22, но тогда особь x5 идентична особи x4. Следуя пункту 2 стратегии мутации убираем предмет №3 с весом 9.  **x5** - 1100110.

Проведем подсчет фитнес-функций

f(x5) = 5+15+11+10=41  (вес 20)  
f(x6) = 5+13+4=22  (вес 13)
##
### Формирование нового поколения (№1)
Для формирования текущего поколения оставляем двух самых сильных особей из предыдущего поколения: **x3** и **x4** (f(x1) = f(x3), поэтому неважно кого выбрать) и двух особей, полученных после скрещивания **x5** и **x6**.

|  Особи |   |   |   |   |   |   |   |
|--------|---|---|---|---|---|---|---|
| **x3** | 1 | 0 | 0 | 1 | 1 | 1 | 1 |
| **x4** | 1 | 0 | 1 | 0 | 1 | 1 | 0 |
| **x5** | 1 | 1 | 0 | 0 | 1 | 1 | 0 |
| **x6** | 1 | 0 | 1 | 0 | 0 | 0 | 1 |

f(x3) = 5+7+11+10+4=37  (вес 20)  
f(x4) = 5+13+11+10=39  (вес 22)  
f(x5) = 5+15+11+10=41  (вес 20)  
f(x6) = 5+13+4=22  (вес 13)
##
### Скрещивание 
Для скрещивания выбираем сильнейших особей **x4** и **x5**. Метод скрещивания: **одноточечный разрез**, точка разрыва - между 2-й и 3-й позициями. 

|        |       |        |      |       |       |       |       |
|--------|-------|--------|------|-------|-------|-------|-------|
| **x4** | **1** | **0** | **1** | **0** | **1** | **1** | **0** |
| **x5** |     1 |     1 |     0 |     0 |     1 |     1 |     0 |

Получаем 

|        |       |       |       |       |       |       |       |
|--------|-------|-------|-------|-------|-------|-------|-------|
| **x7** | **1** | **0** | 0     | 0     | 1     |     1 |     0 |
| **x8** | 1     | 1     | **1** | **0** | **1** | **1** | **0** |

Особь **x8** является нежизнеспособной, сумма весов предметов = 29. Следуя принципам стратегии мутации, убираем предметы №1 и №5 (суммарный все = 7).  **x8** - 0110010.

Проведем подсчет фитнес-функций

f(x7) = 5+11+10=26  (вес 13)  
f(x8) = 15+13+10=38  (вес 22)
##
### Формирование нового поколения (№2)
Для формирования текущего поколения оставляем двух самых сильных особей из предыдущего поколения: **x4** и **x5**  и двух особей, полученных после скрещивания **x7** и **x8**.

|  Особи |   |   |   |   |   |   |   |
|--------|---|---|---|---|---|---|---|
| **x4** | 1 | 0 | 1 | 0 | 1 | 1 | 0 |
| **x5** | 1 | 1 | 0 | 0 | 1 | 1 | 0 |
| **x7** | 1 | 0 | 0 | 0 | 1 | 1 | 0 |
| **x8** | 0 | 1 | 1 | 0 | 0 | 1 | 0 |

f(x4) = 5+13+11+10=39  (вес 22)  
f(x5) = 5+15+11+10=41  (вес 20)  
f(x7) = 5+11+10=26  (вес 13)  
f(x8) = 15+13+10=38  (вес 22)  
##
### Скрещивание 
Для скрещивания выбираем сильнейших особей **x4** и **x5**. Метод скрещивания: **одноточечный разрез**, точка разрыва - между 4-й и 5-й позициями. 

|        |       |        |      |       |       |       |       |
|--------|-------|--------|------|-------|-------|-------|-------|
| **x4** | **1** | **0** | **1** | **0** | **1** | **1** | **0** |
| **x5** |     1 |     1 |     0 |     0 |     1 |     1 |     0 |

Получаем 

|        |       |       |       |       |       |       |       |
|--------|-------|-------|-------|-------|-------|-------|-------|
| **x9** | **1** | **0** | **1** | **0**  | 1     |     1 |     0 |
| **x10**| 1     | 1     |   0   |   0   | **1** | **1** | **0** |

Особи **x9** и **x10** нежизнеспособны, так как являются клонами родителей. Следуя стратегии мутации, применяем пункт "Спонтанная мутация", тогда: 
- для **x9**: так как вес предметов уже 22, то нам нужно избавиться от предмета/предметов согласно пунктам 1 и 2 стратегии мутации: избавимся от предмета №1 весом 2.  **x9**- 0010110.
- для **x10** : так как вес предметов равен 20 и так как свободно места столько же, сколько минимальный вес невзятого предмета №7 (вес = 2), согласно пункту "Спонтанная мутация" в стратегии мутации.  **x10**- 1100111.

Проведем подсчет фитнес-функций

f(x9) = 13+11+10=34  (вес 20)  
f(x10) = 5+15+11+10+4=45  (вес 22)
##
### Формирование нового поколения (№3)
Для формирования текущего поколения оставляем двух самых сильных особей из предыдущего поколения: **x4** и **x5**  и двух особей, полученных после скрещивания **x9** и **x10**.

|  Особи |   |   |   |   |   |   |   |
|--------|---|---|---|---|---|---|---|
| **x4** | 1 | 0 | 1 | 0 | 1 | 1 | 0 |
| **x5** | 1 | 1 | 0 | 0 | 1 | 1 | 0 |
| **x9** | 0 | 0 | 1 | 0 | 1 | 1 | 0 |
| **x10**| 1 | 1 | 0 | 0 | 1 | 1 | 1 |

f(x4) = 5+13+11+10=39  (вес 22)  
f(x5) = 5+15+11+10=41  (вес 20)  
f(x9) = 13+11+10=34  (вес 20)  
f(x10) = 5+15+11+10+4=45  (вес 22)

Достигнуто необходимое количество поколений - 3. По результатам последнего поколения лидером является особь **x10** - 1100111 с фитнес-функцией f(x10) = 45.
##
 ## Ответ:
 - Найденная максимально возможная стоимость предметов в рюкзаке = 45.
 - Набор предметов, обеспечивающий найденную максимальную стоимость: №1, №2, №5, №6, №7.
 - Общий вес предметов рюкзаке = 22.
 - Свободное место в рюкзаке = 0.

# 2. Задача коммивояжера

### Вариант 1:

Матрица расстояний:

|         | **1** | **2** | **3** | **4** | **5** |
|:--------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **1**   | **∞** |   7   |  15   |  15   |  21   |
| **2**   |   6   | **∞** |  15   |   9   |  12   |
| **3**   |   9   |  19   | **∞** |   7   |  12   |
| **4**   |  18   |   7   |  10   | **∞** |   9   |
| **5**   |  11   |  10   |  11   |  13   | **∞** |


##
### Генерация двух особей
Для кодирования замкнутых маршрутов используем натуральное кодирование, при котором хромосома, кодирующая допустимое решение, представляет произвольную перестановку натуральных чисел от 1 до 5. Начальная вершина всегда имеет номер 1. 

|        |   |   |   |   |   |
|--------|---|---|---|---|---|
| **x1** | 1 | 4 | 5 | 3 | 2 |
| **x2** | 1 | 3 | 4 | 2 | 5 |

##
### Расчет фитнес-функций

f(x1) = 1 -> 4 -> 5 -> 3 -> 2 -> 1 = 15 + 9 + 11 + 19 + 6 = 60   
f(x2) = 1 -> 3 -> 4 -> 2 -> 5 -> 1 = 15 + 7 + 7 + 12 + 11 = 52

Так как маршрут замкнутый, необходимо путь завершить в первом городе.

##
### Альтернативная кодировка

***Кодировка для  особи x1***

При использовании альтернативной кодировки требуется добавить две строки: одна содержит возрастающую последовательность чисел, а другая содержит номера позиций. В этой кодировке последовательно выбирается число в натуральном коде, затем ищется в строке с возрастающей последовательностью, и его номер позиции в этой последовательности записывается в альтернативный код.

1.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **1** | 4 | 5 | 3 | 2 |
| Возраст. перестановка | **1** | 2 | 3 | 4 | 5 |
| Номер позиции         | **1** | 2 | 3 | 4 | 5 |
| Альтернативный код    | **1** |   |   |   |   |

2.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **4** | 5 | 3 | 2 |   |
| Возраст. перестановка | 2 | 3 | **4** | 5 |   |
| Номер позиции         | 1 | 2 | **3** | 4 |   |
| Альтернативный код    | 1 | **3** |   |   |   |   |

3.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **5** | 3 | 2 |   |   |
| Возраст. перестановка | 2 | 3 | **5** |   |   |
| Номер позиции         | 1 | 2 | **3** |   |   |
| Альтернативный код    | 1 | 3 |  **3** |   |   |

4. 

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **3** | 2 |   |   |   |
| Возраст. перестановка | 2 | **3** |   |   |   |
| Номер позиции         | 1 | **2** |   |   |   |
| Альтернативный код    | 1 | 3 |  3 | **2** |   |

5.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **2** |   |   |   |   |
| Возраст. перестановка | **2** |   |   |   |   |
| Номер позиции         | **1** |  |   |   |   |
| Альтернативный код    | 1 | 3 |  3 | 2 | **1**  |

#

***Кодировка для  особи x2***

1.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **1** | 3 | 4 | 2 | 5 |
| Возраст. перестановка | **1** | 2 | 3 | 4 | 5 |
| Номер позиции         | **1** | 2 | 3 | 4 | 5 |
| Альтернативный код    | **1** |   |   |   |   |

2.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **3** | 4 | 2 | 5 |   |
| Возраст. перестановка | 2 | **3** | 4 | 5 |   |
| Номер позиции         | 1 | **2** | 3 | 4 |   |
| Альтернативный код    | 1 | **2** |   |   |   |   |

3.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **4** | 2 | 5 |   |   |
| Возраст. перестановка | 2 | **4** | 5 |   |   |
| Номер позиции         | 1 | **2** | 3 |   |   |
| Альтернативный код    | 1 | 2 | **2** |   |   |

4. 

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **2** |5 |   |   |   |
| Возраст. перестановка | **2** | 5 |   |   |   |
| Номер позиции         | **1** | 2 |   |   |   |
| Альтернативный код    | 1 | 2 |  2 | **1** |   |

5.

|                       |   |   |   |   |   |
|-----------------------|---|---|---|---|---|
| Натуральный код       | **5** |   |   |   |   |
| Возраст. перестановка | **5** |   |   |   |   |
| Номер позиции         | **1** |  |   |   |   |
| Альтернативный код    | 1 | 2 |  2 | 1 | **1**  |

##
### Декодирование альтернативной кодировки

***Декодирование  альтернативного кода x1***

При декодировании альтернативной кодировки требуется также добавить две строки: одна содержит возрастающую последовательность чисел, а другая содержит номера позиций в возрастающей последовательности. Только теперь выбранное число в альтернативной кодировке ищется в строке с номером позиции, и его значение в возрастающей перестановке записывается в натуральный код.

1.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **1** | 3 | 3 | 2 | 1 |
| Возраст. перестановка          | **1** | 2 | 3 | 4 | 5 |
| Номер позиции в возраст перест.| **1** | 2 | 3 | 4 | 5 |
| Натуральный код                | **1** |   |   |   |   |

2.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **3** | 3 | 2 | 1 |   |
| Возраст. перестановка          | 2 | 3 | **4** | 5 |   |
| Номер позиции в возраст перест.| 1 | 2 | **3** | 4 |   |
| Натуральный код                | 1 | **4**  |   |   |   |

3.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **3** | 2 | 1 |   |   |
| Возраст. перестановка          | 2 | 3 | **5** |   |   |
| Номер позиции в возраст перест.| 1 | 2 | **3** |   |   |
| Натуральный код                | 1 | 4  | **5** |   |   |

4.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **2** | 1 |   |   |   |
| Возраст. перестановка          | 2 | **3** |  |   |   |
| Номер позиции в возраст перест.| 1 | **2** |  |   |   |
| Натуральный код                | 1 | 4  | 5 | **3**  |   |

5.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **1** |   |   |   |   |
| Возраст. перестановка          | **2** |   |  |   |   |
| Номер позиции в возраст перест.| **1** |   |  |   |   |
| Натуральный код                | 1 | 4  | 5 | 3  | **2**  |

##
***Декодирование  альтернативного кода x2***


1.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **1** | 2 | 2 | 1 | 1 |
| Возраст. перестановка          | **1** | 2 | 3 | 4 | 5 |
| Номер позиции в возраст перест.| **1** | 2 | 3 | 4 | 5 |
| Натуральный код                | **1** |   |   |   |   |

2.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **2** | 2 | 1 | 1 |   |
| Возраст. перестановка          | 2 | **3** | 4 | 5 |   |
| Номер позиции в возраст перест.| 1 | **2** | 3 | 4 |   |
| Натуральный код                | 1 | **3** |   |   |   |

3.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **2** | 1 | 1 |   |   |
| Возраст. перестановка          | 2 | **4** | 5 |   |   |
| Номер позиции в возраст перест.| 1 | **2** | 3 |   |   |
| Натуральный код                | 1 | 3  | **4** |   |   |

4.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **1** | 1 |   |   |   |
| Возраст. перестановка          | **2** | 5 |  |   |   |
| Номер позиции в возраст перест.| **1** | 2 |  |   |   |
| Натуральный код                | 1 | 3  | 4 | **2**  |   |

5.

|                                |   |   |   |   |   |
|--------------------------------|---|---|---|---|---|
| Альтернативный код             | **1** |   |   |   |   |
| Возраст. перестановка          | **5** |   |  |   |   |
| Номер позиции в возраст перест.| **1** |   |  |   |   |
| Натуральный код                | 1 | 3  | 4 | 2  | **5**  |
